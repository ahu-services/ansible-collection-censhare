{{ ansible_managed | comment }}
global
    log         127.0.0.1:514 local0 info
    chroot      /var/lib/haproxy
    pidfile     /var/run/haproxy.pid
    user        haproxy
    group       haproxy
    daemon
    ssl-default-bind-options no-sslv3 no-tlsv10 no-tlsv11 no-tls-tickets
    ssl-default-bind-ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384
    ssl-default-server-ciphers EECDH+AESGCM:EDH+AESGCM
{% if censhare_proxy_ssl == "lets-encrypt" %}
    stats socket /var/run/haproxy/admin.sock level admin mode 660
    setenv ACCOUNT_THUMBPRINT '{{ censhare_proxy_ssl_thumbprint }}'
{% else %}
    stats socket /var/lib/haproxy/stats
{% endif %}

defaults
    mode                    http
    log                     global
    option                  httplog
    option                  dontlognull
    retries                 3
    timeout connect         10s
    timeout client          {{ censhare_proxy_timeout_client }}
    timeout server          {{ censhare_proxy_timeout_server }}
    timeout http-keep-alive 10s
    timeout http-request    10s
    timeout tunnel          1h

{% if censhare_proxy_stats_enabled | bool %}
listen stats
  bind *:{{ censhare_proxy_stats_port }}
  stats enable
  stats uri {{ censhare_proxy_stats_uri }}
  stats refresh {{ censhare_proxy_stats_refresh }}
  stats auth {{ censhare_proxy_stats_user }}:{{ censhare_proxy_stats_pass }}
{% endif %}
